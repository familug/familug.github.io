<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="hvn" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="ps, top, thread, process, linux, unix, OS, CPU, rust, Python, frontpage, " />

<meta property="og:title" content="CPU ch·∫°y thread hay process? "/>
<meta property="og:url" content="./cpu-chay-thread-hay-process.html" />
<meta property="og:description" content="Hay nh·ªØng c√¢u h·ªèi li√™n quan: Thread v√† process kh√°c g√¨ nhau? 1 process ch·∫°y multithreading tr√™n m·∫•y CPU? V√¨ sao Java, Rust kh√¥ng nh·∫Øc t·ªõi multiprocessing? Khi ch·∫°y CPU bound, d√πng multi-process hay multi-threaded? b√†i n√†y s·∫Ω l√†m cho ra nh·∫Ω. Vi·ªác kh√≥ khƒÉn nh·∫•t khi tr·∫£ l·ªùi c√°c ‚Ä¶" />
<meta property="og:site_name" content="FAMILUG.org Vietnam" />
<meta property="og:article:author" content="hvn" />
<meta property="og:article:published_time" content="2023-06-26T00:00:00+07:00" />
<meta name="twitter:title" content="CPU ch·∫°y thread hay process? ">
<meta name="twitter:description" content="Hay nh·ªØng c√¢u h·ªèi li√™n quan: Thread v√† process kh√°c g√¨ nhau? 1 process ch·∫°y multithreading tr√™n m·∫•y CPU? V√¨ sao Java, Rust kh√¥ng nh·∫Øc t·ªõi multiprocessing? Khi ch·∫°y CPU bound, d√πng multi-process hay multi-threaded? b√†i n√†y s·∫Ω l√†m cho ra nh·∫Ω. Vi·ªác kh√≥ khƒÉn nh·∫•t khi tr·∫£ l·ªùi c√°c ‚Ä¶">

        <title>CPU ch·∫°y thread hay process?  ¬∑ FAMILUG.org Vietnam
</title>



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>FAMILUG.org Vietnam</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       .
                                    >Home</a>
                                </li>
                                <li ><a href="./categories.html">Categories</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li ><a href="./archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="./search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./cpu-chay-thread-hay-process.html">
                CPU ch·∫°y thread hay process?
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>Hay nh·ªØng c√¢u h·ªèi li√™n quan:</p>
<ul>
<li>Thread v√† process kh√°c g√¨ nhau?</li>
<li>1 process ch·∫°y multithreading tr√™n m·∫•y CPU?</li>
<li>V√¨ sao Java, Rust kh√¥ng nh·∫Øc t·ªõi multiprocessing?</li>
<li>Khi ch·∫°y CPU bound, d√πng multi-process hay multi-threaded?</li>
</ul>
<p>b√†i n√†y s·∫Ω l√†m cho ra nh·∫Ω.</p>
<p>Vi·ªác kh√≥ khƒÉn nh·∫•t khi tr·∫£ l·ªùi c√°c c√¢u h·ªèi n√†y l√† t√¨m ƒë∆∞·ª£c c√°c t√†i li·ªáu c√≥ t√≠nh "chu·∫©n m·ª±c"/cƒÉn c·ª©, kh√¥ng ph·∫£i m·∫•y trang tutorial, wikipedia hay h·ªèi ƒë√°p tr√™n m·∫°ng.</p>
<h2>Process l√† g√¨, thread l√† g√¨</h2>
<p>Ng∆∞·ªùi d√πng m√°y t√≠nh th∆∞·ªùng bi·∫øt ƒë·∫øn kh√°i ni·ªám <code>process</code> tr∆∞·ªõc, n√≥ hi·ªÉn th·ªã m·∫∑c ƒë·ªãnh tr√™n c√°c ch∆∞∆°ng tr√¨nh process manager nh∆∞ <code>top</code>, hay <code>ps</code>, hay <code>Monitor</code> tr√™n Ubuntu, hay c·∫£ <code>Task manager</code> tr√™n Windows.
M·ªói process ƒë∆∞·ª£c g√°n cho 1 s·ªë ProcessID (PID), d√πng l·ªánh <code>kill -9 PID</code> ƒë·ªÉ t·∫Øt ch∆∞∆°ng tr√¨nh b·ªã "treo".
Khi ch·∫°y 1 ch∆∞∆°ng tr√¨nh, h·ªá ƒëi·ªÅu h√†nh s·∫Ω t·∫°o ra 1 (hay v√†i) process.</p>
<p>Cho t·ªõi khi h·ªçc l·∫≠p tr√¨nh Python, th·∫•y m·ªói ch∆∞∆°ng tr√¨nh ch·ªâ ch·∫°y code tu·∫ßn t·ª± t·ª´ tr√™n xu·ªëng, nh·∫≠n ra r·∫±ng m·ªói 1 process ch·ªâ ch·∫°y 1 "lu·ªìng" (thread), h·ªçc th√™m th∆∞ vi·ªán <code>threading</code>, bi·∫øt t·∫°o 2 3 4 thread ch·∫°y "c√πng l√∫c" trong 1 process.</p>
<p>·ªû ƒë√¢y d√πng kh√°i ni·ªám process v√† thread c·ªßa h·ªá ƒëi·ªÅu h√†nh (OS), m·ªôt s·ªë ng√¥n ng·ªØ l·∫≠p tr√¨nh c√≥ kh√°i ni·ªám process c·ªßa ri√™ng m√¨nh, VD: Erlang process kh√¥ng gi·ªëng nh∆∞ OS process.</p>
<p>Tr√™n h·ªá ƒëi·ªÅu h√†nh d√πng Linux nh∆∞ Ubuntu, g√µ <code>man 7 pthreads</code>,
<code>pthread</code> hay POSIX thread, l√† "OS thread" tr√™n Linux:</p>
<blockquote>
<p>A single process can contain multiple threads, all of
which are executing the same program.  These threads share the
same global memory (data and heap segments), but each thread has
its own stack (automatic variables).</p>
</blockquote>
<p>C√°c thread trong 1 process d√πng chung d·ªØ li·ªáu (share data) v√† file description, nh∆∞ng c√≥ stack ri√™ng.</p>
<p>Theo <a href="https://man.openbsd.org/pthreads.3"><code>man 3 pthreads</code> tr√™n OpenBSD</a>:</p>
<blockquote>
<p>A thread is a flow of control within a process. Each thread represents a
minimal amount of state: normally just the CPU state and a signal mask. All
other process state (such as memory, file descriptors) is shared among all of
the threads in the process.</p>
<p>In OpenBSD, threads use a 1-to-1 implementation, where every thread is
independently scheduled by the kernel.</p>
</blockquote>
<p>Theo <a href="https://man.freebsd.org/cgi/man.cgi?query=pthread"><code>man 3 pthread</code> tr√™n FreeBSD</a></p>
<blockquote>
<p>POSIX threads are a set of    functions that support applications with re-
quirements    for multiple flows of control, called threads, within a process.
Multithreading is used to improve the performance of a program.</p>
</blockquote>
<p>Hai BSD OS ƒë·ªÅu ƒë·ªãnh nghƒ©a thread l√† m·ªôt <code>flow of control</code> trong 1 process.</p>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/procthread/processes-and-threads">Theo Microsoft</a>, nh√† s·∫£n xu·∫•t h·ªá ƒëi·ªÅu h√†nh nhi·ªÅu ng∆∞·ªùi d√πng nh·∫•t tr√™n th·∫ø gi·ªõi ƒë·ªãnh nghƒ©a: 1 process ƒë∆°n gi·∫£n l√† 1 ch∆∞∆°ng tr√¨nh ƒëang ch·∫°y.
Hay <a href="https://learn.microsoft.com/en-gb/windows/win32/procthread/about-processes-and-threads">chi ti·∫øt h∆°n</a>: <strong>m·ªôt process cung c·∫•p c√°c t√†i nguy√™n ƒë·ªÉ ch·∫°y 1 ch∆∞∆°ng tr√¨nh (code, file description, memory, ... v√† √≠t nh·∫•t 1 thread)</strong>, m·ªôt process b·∫Øt ƒë·∫ßu v·ªõi 1 thread, th∆∞·ªùng ƒë∆∞·ª£c g·ªçi l√† primary/main thread.</p>
<p>C√≤n <strong>thread l√† ƒë∆°n v·ªã m√† ƒë∆∞·ª£c h·ªá ƒëi·ªÅu h√†nh cung c·∫•p cho th·ªùi gian d√πng CPU</strong>.</p>
<h3>So s√°nh process v√† thread</h3>
<p>Kh√°i ni·ªám process c√≥ tr∆∞·ªõc, m√£i sau n√†y m·ªõi c√≥ kh√°i ni·ªám (nhi·ªÅu) thread.
M·∫∑c d√π khi c√≥ 1 process th√¨ n√≥ lu√¥n lu√¥n ch·∫°y 1 thread.
Trong 1 process c√≥ th·ªÉ c√≥ nhi·ªÅu thread, trong 1 thread kh√¥ng th·ªÉ c√≥ nhi·ªÅu process.</p>
<p>Nh∆∞ng th·ª±c ra ph·∫ßn l·ªõn ng∆∞·ªùi ta mu·ªën h·ªèi:</p>
<h3>So s√°nh multi thread v√† multi process</h3>
<p>Multi thread gi·ªëng nh∆∞ multi process, ngo·∫°i tr·ª´ 1 vi·ªác: c√°c thread share chung memory c√≤n process th√¨ kh√¥ng.</p>
<h2>Multitasking - ƒëa nhi·ªám</h2>
<p>M√°y t√≠nh ng√†y nay CPU 4 l√µi, 8 l√µi (core)... lu√¥n ch·∫°y nhi·ªÅu ch∆∞∆°ng tr√¨nh c√πng l√∫c. M√°y t√≠nh ng√†y x∆∞a khi ch·ªâ c√≥ 1 CPU 1 core c≈©ng v·∫≠y, ch·∫°y ƒë∆∞·ª£c nhi·ªÅu ch∆∞∆°ng tr√¨nh "c√πng l√∫c" nh·ªù CPU chuy·ªÉn li√™n t·ª•c ch·∫°y c√°c ch∆∞∆°ng tr√¨nh kh√°c nhau, vi·ªác chuy·ªÉn ƒë·ªïi r·∫•t nhanh n√†y khi·∫øn ng∆∞·ªùi d√πng c√≥ c·∫£m gi√°c l√† ch·∫°y c√πng l√∫c. V√≠ d·ª• ch·∫°y 4 process A B C D:</p>
<div class="highlight"><pre><span></span><code>A B C D A B D C B A C D...
</code></pre></div>

<p>chuy·ªán n√†y kh√¥ng thay ƒë·ªïi k·ªÉ c·∫£ v·ªõi m√°y t√≠nh nhi·ªÅu core do s·ªë ch∆∞∆°ng tr√¨nh ch·∫°y lu√¥n l·ªõn h∆°n s·ªë core nhi·ªÅu l·∫ßn. V√≠ d·ª•:</p>
<div class="highlight"><pre><span></span><code>$ grep -c processor /proc/cpuinfo
<span class="m">4</span>
$ ps -ef <span class="p">|</span> wc -l
<span class="m">287</span>
</code></pre></div>

<p>PS: b·∫°n ƒë·ªçc sau khi ƒë·ªçc xong b√†i v√† tham kh·∫£o <a href="./ps-va-top-hien-thi-so-thread.html">xem thread b·∫±ng top</a> s·∫Ω ch·∫°y <code>ps -eLf</code></p>
<h3>CPU Scheduler</h3>
<p>Vi·ªác s·∫Øp x·∫øp c√°c ch∆∞∆°ng tr√¨nh ch·∫°y th·∫ø n√†o (d√πng CPU th·∫ø n√†o) do m·ªôt b·ªô ph·∫≠n c·ªßa kernel c√≥ t√™n "scheduler" th·ª±c hi·ªán.
ƒê·ªçc th√™m v·ªÅ Linux CPU scheduler t·∫°i <a href="https://opensource.com/article/19/2/fair-scheduling-linux">https://opensource.com/article/19/2/fair-scheduling-linux</a>.</p>
<h2>CPU ch·∫°y thread hay process?</h2>
<p>Tham kh·∫£o t·∫°i <code>man 7 sched</code></p>
<div class="highlight"><pre><span></span><code>$ whatis sched
sched <span class="o">(</span><span class="m">7</span><span class="o">)</span>            - overview of CPU scheduling
</code></pre></div>

<p>Trong t√†i li·ªáu vi·∫øt:</p>
<div class="highlight"><pre><span></span><code><span class="nv">Scheduling</span><span class="w"> </span><span class="nv">policies</span><span class="w"></span>
<span class="w">   </span><span class="nv">The</span><span class="w"> </span><span class="nv">scheduler</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">kernel</span><span class="w"> </span><span class="nv">component</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">decides</span><span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="nv">runnable</span><span class="w"> </span><span class="nv">thread</span><span class="w"></span>
<span class="w">   </span><span class="nv">will</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">executed</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">CPU</span><span class="w"> </span><span class="k">next</span>.<span class="w">  </span><span class="nv">Each</span><span class="w"> </span><span class="nv">thread</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">associated</span><span class="w"></span>
<span class="w">   </span><span class="nv">scheduling</span><span class="w"> </span><span class="nv">policy</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">a</span><span class="w">  </span><span class="nv">static</span><span class="w"> </span><span class="nv">scheduling</span><span class="w">  </span><span class="nv">priority</span>,<span class="w"> </span><span class="nv">sched_priority</span>.<span class="w">  </span><span class="nv">The</span><span class="w"></span>
<span class="w">   </span><span class="nv">scheduler</span><span class="w"> </span><span class="nv">makes</span><span class="w">  </span><span class="nv">its</span><span class="w">  </span><span class="nv">decisions</span><span class="w">  </span><span class="nv">based</span><span class="w">  </span><span class="nv">on</span><span class="w"> </span><span class="nv">knowledge</span><span class="w">  </span><span class="nv">of</span><span class="w">  </span><span class="nv">the</span><span class="w">  </span><span class="nv">scheduling</span><span class="w"></span>
<span class="w">   </span><span class="nv">policy</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">priority</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">threads</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">sys</span>‚Äê<span class="w"> </span><span class="nv">tem</span>.<span class="w"></span>
...<span class="w"></span>
<span class="nv">API</span><span class="w"> </span><span class="nv">summary</span><span class="w"></span>
<span class="w">   </span><span class="nv">Linux</span><span class="w"> </span><span class="nv">provides</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">following</span><span class="w"> </span><span class="nv">system</span><span class="w">  </span><span class="nv">calls</span><span class="w"> </span><span class="k">for</span><span class="w">  </span><span class="nv">controlling</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">CPU</span><span class="w"></span>
<span class="w">   </span><span class="nv">scheduling</span><span class="w"> </span><span class="nv">behavior</span>,<span class="w"> </span><span class="nv">policy</span>,<span class="w">  </span><span class="nv">and</span><span class="w">  </span><span class="nv">priority</span><span class="w">  </span><span class="nv">of</span><span class="w">  </span><span class="nv">processes</span><span class="w"> </span><span class="ss">(</span><span class="nv">or</span>,<span class="w"> </span><span class="nv">more</span><span class="w"></span>
<span class="w">   </span><span class="nv">precisely</span>,<span class="w"> </span><span class="nv">threads</span><span class="ss">)</span>.<span class="w"></span>
</code></pre></div>

<p>Linux kernel scheduler s·∫Øp x·∫øp l·ªãch ch·∫°y tr√™n CPU cho c√°c thread (hay g·ªçi l√† task).
Trong <code>man 1 taskset</code> vi·∫øt:</p>
<div class="highlight"><pre><span></span><code><span class="o">-</span><span class="nv">a</span>,<span class="w"> </span><span class="o">--</span><span class="nv">all</span><span class="o">-</span><span class="nv">tasks</span><span class="w"></span>
<span class="w">  </span><span class="nv">Set</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">retrieve</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">CPU</span><span class="w"> </span><span class="nv">affinity</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">tasks</span><span class="w"> </span><span class="ss">(</span><span class="nv">threads</span><span class="ss">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">given</span><span class="w"> </span><span class="nv">PID</span>.<span class="w"></span>
</code></pre></div>

<h2>M·ªôt process ch·∫°y multithreading tr√™n m·∫•y CPU core?</h2>
<p>V·ªõi 10 process, m·ªói process ch·ªâ c√≥ 1 thread, s·∫Ω l√† 10 thread c·∫ßn ch·∫°y, kernel s·∫Ω sched (x·∫øp l·ªãch) vi·ªác ch·∫°y 10 task n√†y cho N CPU.
T∆∞∆°ng t·ª± 1 process, ch·∫°y 10 thread, kernel c≈©ng s·∫Ω sched vi·ªác ch·∫°y 10 task n√†y cho N CPU (N &gt; 0).</p>
<p>What?!</p>
<h3>Python multi-threaded vs multi-process</h3>
<p>D√≤ng th·ª© 2 trong t√†i li·ªáu th∆∞ vi·ªán <a href="https://docs.python.org/3/library/threading.html#module-threading"><code>threading</code> c·ªßa Python</a> vi·∫øt</p>
<blockquote>
<p>CPython implementation detail: In CPython, due to the Global Interpreter
Lock, only one thread can execute Python code at once (even though certain
performance-oriented libraries might overcome this limitation). If
you want your application to make better use of the computational resources
of multi-core machines, you are advised to use multiprocessing or
concurrent.futures.ProcessPoolExecutor. However, threading is still an
appropriate model if you want to run multiple I/O-bound tasks simultaneously.</p>
</blockquote>
<p>Python l√† m·ªôt trong s·ªë √≠t ng√¥n ng·ªØ m√† nhi·ªÅu thread kh√¥ng ch·∫°y ƒë∆∞·ª£c tr√™n nhi·ªÅu CPU core c√πng l√∫c do gi·ªõi h·∫°n c·ªßa <a href="https://docs.python.org/3/glossary.html#term-global-interpreter-lock">Global Interpreter Lock - GIL</a> trong CPython/PyPy.
Gi·ªõi h·∫°n n√†y <strong>KH√îNG</strong> t·ªìn t·∫°i trong c√°c b·∫£n Python kh√°c nh∆∞ Jython (tr√™n JVM) v√† IronPython (tr√™n .NET).
V√¨ GIL, CPython ch·ªâ c√≥ th·ªÉ <strong>ch·∫°y tr√™n CPU</strong> 1 thread 1 l√∫c, n√™n mu·ªën ch·∫°y nhi·ªÅu thread/process tr√™n nhi·ªÅu CPU core c√πng l√∫c, Python c√≥ th∆∞ vi·ªán <a href="https://docs.python.org/3/library/multiprocessing.html">multiprocessing</a>.</p>
<blockquote>
<p>multiprocessing is a package that supports spawning processes using an API
similar to the threading module. The multiprocessing package offers both
local and remote concurrency, effectively side-stepping the Global
Interpreter Lock by using subprocesses instead of threads. Due to this, the
multiprocessing module allows the programmer to fully leverage multiple
processors on a given machine.</p>
</blockquote>
<p>Tr√°nh nh·∫ßm l·∫´n r·∫±ng python <code>threading</code> th·ª±c s·ª± ch·∫°y c√°c thread c√πng l√∫c tr√™n nhi·ªÅu CPU core, vi·ªác c√°c thread c√≥ v·∫ª ch·∫°y c√πng l√∫c trong Python ch·ªâ l√† multitasking, ch·∫°y chuy·ªÉn ƒë·ªïi gi·ªØa c√°c thread.</p>
<h3>Java multithreading</h3>
<p>Java h·ªó tr·ª£ multithreading v·ªõi c√°c thread ch·∫°y c√πng l√∫c nh∆∞ mong ƒë·ª£i, v√† nhi·ªÅu thread n√†y ho√†n to√†n c√≥ th·ªÉ ƒë∆∞·ª£c ch·∫°y tr√™n nhi·ªÅu CPU core.</p>
<p>V√¨ multithreading ch·∫°y r·∫•t ngon l√†nh, n√™n √≠t c√≥ l√Ω do g√¨ ƒë·ªÉ sinh ra kh√°i ni·ªám "multiprocessing" nh∆∞ Python.
Ngo√†i ra, b·∫≠t 1 Java process l√† ch·∫°y 1 m√°y ·∫£o JVM n·∫∑ng n·ªÅ, kh·ªüi ƒë·ªông ch·∫≠m (so v·ªõi b·∫≠t 1 process CPython interpreter 0.1s 8MB RAM) n√™n vi·ªác n√†y r·∫•t √≠t th·∫•y trong th·ª±c t·∫ø.</p>
<p>PS: Python <code>threading</code> API <a href="https://docs.python.org/2/library/threading.html">d·ª±a tr√™n API c·ªßa Java</a></p>
<h3>Rust multithreading</h3>
<p>T∆∞∆°ng t·ª± Java, kh√¥ng t·ªìn t·∫°i th∆∞ vi·ªán "multiprocessing" trong Rust.</p>
<blockquote>
<p>In most current operating systems, an executed program‚Äôs code is run in a
process, and the operating system will manage multiple processes at once.
Within a program, you can also have independent parts that run
simultaneously. The features that run these independent parts are called
threads. For example, a web server could have multiple threads so that it
could respond to more than one request at the same time.</p>
</blockquote>
<p><a href="https://doc.rust-lang.org/book/ch16-01-threads.html">https://doc.rust-lang.org/book/ch16-01-threads.html</a></p>
<h3>Go multithreading, multiprocessing</h3>
<p>Go kh√¥ng d√πng kh√°i ni·ªám process hay thread c·ªßa h·ªá ƒëi·ªÅu h√†nh m√† d√πng kh√°i ni·ªám Goroutine, t∆∞∆°ng t·ª± thread, nh∆∞ng do Go runtime qu·∫£n l√Ω thay v√¨ OS kernel.</p>
<blockquote>
<p>A goroutine is a lightweight thread managed by the Go runtime.
Goroutines run in the same address space, so access to shared memory must be synchronized.</p>
</blockquote>
<p><a href="https://go.dev/tour/concurrency/1">https://go.dev/tour/concurrency/1</a></p>
<p>C√°c goroutine c≈©ng c√≥ th·ªÉ ƒë∆∞·ª£c nhi·ªÅu CPU core ch·∫°y c√πng l√∫c</p>
<blockquote>
<p>GOMAXPROCS sets the maximum number of CPUs that can be executing simultaneously and returns the previous setting.</p>
</blockquote>
<h2>Khi ch·∫°y CPU bound, d√πng multi process hay multi thread?</h2>
<ul>
<li>CPU bound l√† ch∆∞∆°ng tr√¨nh d√†nh ph·∫ßn l·ªõn th·ªùi gian d√πng CPU x·ª≠ l√Ω, kh√°c v·ªõi</li>
<li>IO bound l√† ch∆∞∆°ng tr√¨nh d√†nh ph·∫ßn l·ªõn th·ªùi gian ƒë·ªçc ghi file/network.</li>
</ul>
<p>C√¢u h·ªèi n√†y c√≥ th·ªÉ l√† trap, c·∫ßn h·ªèi l·∫°i d√πng ng√¥n ng·ªØ g√¨, tr·ª´ khi h·ªèi c·ª• th·ªÉ t·ªõi Python th√¨ tr·∫£ l·ªùi d√πng multiprocessing.
Trong c√°c ng√¥n ng·ªØ kh√°c nh∆∞ Rust/Java, multithreading l√† c√¢u tr·∫£ l·ªùi, v√¨ kh√¥ng c√≥ th∆∞ vi·ªán multi-process m√† ch·∫°y.
Hay Go ch·ªâ c√≥ goroutine ch·ª© kh√¥ng c√≥ l·ª±a ch·ªçn kh√°c.</p>
<p>Khi n√≥i chung chung, multi-process c√≥ ∆∞u ƒëi·ªÉm l√† s·ª± t√°ch bi·ªát gi·ªØa c√°c process, m·ªôt process b·ªã crash s·∫Ω kh√¥ng ·∫£nh h∆∞·ªüng t·ªõi process kh√°c, nh∆∞·ª£c ƒëi·ªÉm l√† vi·ªác giao ti·∫øp gi·ªØa c√°c process ƒë·ªÉ chia s·∫ª data s·∫Ω ph·ª©c t·∫°p.
Nhi·ªÅu ch∆∞∆°ng tr√¨nh d√πng m√¥ h√¨nh n√†y nh∆∞:</p>
<ul>
<li>postgresql</li>
<li>nginx master-workers</li>
</ul>
<p>Multi-threaded gi√∫p d·ªÖ d√†ng truy c·∫≠p b·ªô nh·ªõ chung, nh∆∞ng c√≥ th·ªÉ g·∫∑p tr∆∞·ªùng h·ª£p 1 thread crash khi·∫øn c·∫£ ch∆∞∆°ng tr√¨nh t·∫Øt ng√≥m, nh∆∞·ª£c ƒëi·ªÉm l√† d·ªÖ x·∫£y ra race-condition: N thread tranh nhau truy c·∫≠p c√πng 1 t√†i nguy√™n.</p>
<p>Kh√¥ng c√≥ c√¢u tr·∫£ l·ªùi d·ªÖ d√†ng, v√¨ ƒë√¢y l√† tr∆∞·ªùng h·ª£p c·ªßa PostgreSQL, sau v√†i ch·ª•c nƒÉm ch·∫°y multi-process, nay ƒëang kh√°m ph√° option multi-threaded.</p>
<p><a href="https://www.postgresql.org/message-id/flat/31cc6df9-53fe-3cd9-af5b-ac0d801163f4%40iki.fi">Let's make PostgreSQL multi-threaded</a></p>
<h3>Tham kh·∫£o</h3>
<ul>
<li>OSTEP: <a href="https://pages.cs.wisc.edu/~remzi/OSTEP/threads-intro.pdf">https://pages.cs.wisc.edu/~remzi/OSTEP/threads-intro.pdf</a></li>
<li><a href="https://www.postgresql.org/message-id/flat/31cc6df9-53fe-3cd9-af5b-ac0d801163f4%40iki.fi">https://www.postgresql.org/message-id/flat/31cc6df9-53fe-3cd9-af5b-ac0d801163f4%40iki.fi</a></li>
<li><a href="https://pages.cs.wisc.edu/~remzi/OSTEP/threads-intro.pdf">https://pages.cs.wisc.edu/~remzi/OSTEP/threads-intro.pdf</a></li>
<li><a href="https://opensource.com/article/19/2/fair-scheduling-linux">https://opensource.com/article/19/2/fair-scheduling-linux</a></li>
<li><a href="https://man.openbsd.org/pthreads.3">https://man.openbsd.org/pthreads.3</a></li>
<li><a href="https://man.freebsd.org/cgi/man.cgi?query=pthread">https://man.freebsd.org/cgi/man.cgi?query=pthread</a></li>
<li><a href="https://learn.microsoft.com/en-us/windows/win32/procthread/processes-and-threads">https://learn.microsoft.com/en-us/windows/win32/procthread/processes-and-threads</a></li>
<li><a href="https://learn.microsoft.com/en-gb/windows/win32/procthread/about-processes-and-threads">https://learn.microsoft.com/en-gb/windows/win32/procthread/about-processes-and-threads</a></li>
<li><a href="https://go.dev/tour/concurrency/1">https://go.dev/tour/concurrency/1</a></li>
<li><a href="https://docs.python.org/3/library/multiprocessing.html">https://docs.python.org/3/library/multiprocessing.html</a></li>
<li><a href="https://docs.python.org/3/glossary.html#term-global-interpreter-lock">https://docs.python.org/3/glossary.html#term-global-interpreter-lock</a></li>
<li><a href="https://docs.python.org/2/library/threading.html">https://docs.python.org/2/library/threading.html</a></li>
<li><a href="https://doc.rust-lang.org/book/ch16-01-threads.html">https://doc.rust-lang.org/book/ch16-01-threads.html</a></li>
</ul>
<h3>K·∫øt lu·∫≠n</h3>
<p>Thread l√† ƒë∆°n v·ªã task ƒë∆∞·ª£c kernel sched ch·∫°y tr√™n nhi·ªÅu CPU, process l√† 1 ch∆∞∆°ng tr√¨nh ƒëang ch·∫°y.</p>
<p>H·∫øt.</p>
<p>HVN at <a href="http://pymi.vn">http://pymi.vn</a> and <a href="https://www.familug.org">https://www.familug.org</a>.</p>
<p><a href="https://www.familug.org/p/ung-ho.html">·ª¶ng h·ªô t√°c gi·∫£ üç∫</a></p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2023-06-26T00:00:00+07:00">Mon 26 June 2023</time>
            <h4>Category</h4>
            <a class="category-link" href="./categories.html#frontpage-ref">frontpage</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#cpu-ref">CPU
                    <span class="superscript">1</span>
</a></li>
                <li><a href="./tags.html#linux-ref">linux
                    <span class="superscript">9</span>
</a></li>
                <li><a href="./tags.html#os-ref">OS
                    <span class="superscript">1</span>
</a></li>
                <li><a href="./tags.html#process-ref">process
                    <span class="superscript">1</span>
</a></li>
                <li><a href="./tags.html#ps-ref">ps
                    <span class="superscript">2</span>
</a></li>
                <li><a href="./tags.html#python-ref">Python
                    <span class="superscript">13</span>
</a></li>
                <li><a href="./tags.html#rust-ref">rust
                    <span class="superscript">12</span>
</a></li>
                <li><a href="./tags.html#thread-ref">thread
                    <span class="superscript">2</span>
</a></li>
                <li><a href="./tags.html#top-ref">top
                    <span class="superscript">2</span>
</a></li>
                <li><a href="./tags.html#unix-ref">unix
                    <span class="superscript">2</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>